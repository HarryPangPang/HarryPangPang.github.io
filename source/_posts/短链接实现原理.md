---
title: 短链接实现原理
date: 2023-02-20 11:41:21
tags: 后端
---

## 使用背景
短链接顾名思义，就是将长链接转义成短链接。主要使用场景如下：
* 短信发送长度限制
* 长链接生成的二维码过于密集，无法使用扫码功能
* 社交媒体的字符限制

## 大体流程

1. 用户访问短链接
2. 服务器查找短链接的key，在数据库/缓存中找到对应长链接参数
3. 替换参数并重定向
4. 用户成功访问到长链接网页内容

## python代码示例(flask)

### 生成：
```
def getLink(shortKey):
    redisKey = "short_link:"+shortKey
    url = r.get(redisKey)
    if not url:
        return None
    return url
def save(shortKey, url):
    redisKey = "short_link:"+shortKey
    url = r.set(redisKey, url, 3600*24)
    return

def shortLink():
    requestUrl = request.url
    requestUrl = requestUrl.replace("http://", "https://")

    # xx(路由地址)
    url = requestUrl.replace("/shortLink?", "/xxx?")

    # 将地址参数进行md5转化
    hash_md5 = hashlib.md5()
    hash_md5.update(url.encode('utf-8'))
    shortKey = hash_md5.hexdigest()

    # 获取地址
    arrUrl = requestUrl.split("/shortLink?")
    urlHost = arrUrl[0]
    shortUrl = urlHost + "/to?short_key=" + shortKey

    # 获得短链地址并存储
    savedUrl = getLink(shortKey)
    if not savedUrl:
        save(shortKey, url)
    return shortUrl
```

### 访问：
```
def to():
    shortKey = request.args.get("short_key")

    if not shortKey:
        return ('short key not found', 404)

    url = getLink(shortKey)
    if not url:
        return ('full url not found', 404)
    return redirect(url)

```